<div align="center">
  <h1>âš™ï¸ Roma æ¸¸æˆæ ¸å¿ƒä¸šåŠ¡æœåŠ¡</h1>
  <p><em>go-pantheon ç”Ÿæ€ç³»ç»Ÿçš„é«˜æ€§èƒ½æ¸¸æˆæ ¸å¿ƒä¸šåŠ¡æœåŠ¡æ¡†æ¶</em></p>
</div>

<p align="center">
<a href="https://github.com/go-pantheon/roma/actions/workflows/test.yml"><img src="https://github.com/go-pantheon/roma/workflows/Test/badge.svg" alt="æµ‹è¯•çŠ¶æ€"></a>
<a href="https://github.com/go-pantheon/roma/releases"><img src="https://img.shields.io/github/v/release/go-pantheon/roma" alt="æœ€æ–°ç‰ˆæœ¬"></a>
<a href="https://pkg.go.dev/github.com/go-pantheon/roma"><img src="https://pkg.go.dev/badge/github.com/go-pantheon/roma" alt="GoDoc"></a>
<a href="https://goreportcard.com/report/github.com/go-pantheon/roma"><img src="https://goreportcard.com/badge/github.com/go-pantheon/roma" alt="Go Report Card"></a>
<a href="https://github.com/go-pantheon/roma/blob/main/LICENSE"><img src="https://img.shields.io/github/license/go-pantheon/roma" alt="è®¸å¯è¯"></a>
<a href="https://deepwiki.com/go-pantheon/roma"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>

<p align="center">
  <a href="README.md">English</a> | <a href="README-zh.md">ä¸­æ–‡</a>
</p>

## å…³äº Roma

Roma æ˜¯åŸºäºå¾®æœåŠ¡æ¶æ„çš„é«˜æ€§èƒ½æ¸¸æˆæ ¸å¿ƒä¸šåŠ¡æœåŠ¡æ¡†æ¶ï¼Œé‡‡ç”¨ Go è¯­è¨€å¼€å‘ã€‚Roma ä»¥ monorepo å½¢å¼ç»„ç»‡ï¼ŒåŒ…å«å¤šä¸ªç‹¬ç«‹éƒ¨ç½²çš„æ¸¸æˆæœåŠ¡ï¼ˆå¦‚ Playerã€Roomã€Team ç­‰ï¼‰ï¼Œæ¯ä¸ªæœåŠ¡ä¸“æ³¨äºç‰¹å®šçš„æ¸¸æˆä¸šåŠ¡é¢†åŸŸã€‚Roma æ˜¯ go-pantheon ç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¤„ç†å…·ä½“çš„æ¸¸æˆä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ç®¡ç†ã€‚

æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼š[deepwiki/go-pantheon/roma](https://deepwiki.com/go-pantheon/roma)

## å…³äº go-pantheon ç”Ÿæ€ç³»ç»Ÿ

**go-pantheon** æ˜¯ä¸€ä¸ªå¼€ç®±å³ç”¨çš„æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶ï¼ŒåŸºäºå¾®æœåŠ¡æ¶æ„æä¾›é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ¸¸æˆæœåŠ¡å™¨é›†ç¾¤è§£å†³æ–¹æ¡ˆã€‚Roma ä½œä¸ºæ¸¸æˆä¸šåŠ¡é€»è¾‘å®ç°ç»„ä»¶ï¼Œä¸å…¶ä»–æ ¸å¿ƒæœåŠ¡åä½œæ„æˆå®Œæ•´çš„æ¸¸æˆæœåŠ¡ç”Ÿæ€ç³»ç»Ÿï¼š

- **Roma**: æ¸¸æˆæ ¸å¿ƒä¸šåŠ¡æœåŠ¡ï¼Œè´Ÿè´£æ¸¸æˆé€»è¾‘å¤„ç†å’Œæ•°æ®ç®¡ç†
- **Janus**: ç½‘å…³æœåŠ¡ï¼Œè´Ÿè´£å®¢æˆ·ç«¯è¿æ¥å¤„ç†å’Œè¯·æ±‚è½¬å‘
- **Lares**: è´¦æˆ·æœåŠ¡ï¼Œè´Ÿè´£ç”¨æˆ·è®¤è¯å’Œè´¦æˆ·ç®¡ç†
- **Senate**: åå°ç®¡ç†æœåŠ¡ï¼Œæä¾›è¿è¥ç®¡ç†æ¥å£

## æ ¸å¿ƒä¼˜åŠ¿

### ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„
- **Monorepo ç®¡ç†**: ç»Ÿä¸€ä»£ç ç®¡ç†ï¼Œç‹¬ç«‹æœåŠ¡éƒ¨ç½²
- **åŠ¨æ€æ‰©ç¼©å®¹**: ç”¨æˆ·æ— æ„ŸçŸ¥çš„åœ¨çº¿æ‰©å®¹å’Œè´Ÿè½½å‡è¡¡
- **æœåŠ¡å‘ç°**: åŸºäº etcd çš„è‡ªåŠ¨æœåŠ¡æ³¨å†Œå’Œå‘ç°

### âš¡ é«˜æ€§èƒ½å¤„ç†
- **å¼‚æ­¥æ¶æ„**: åˆ†å¸ƒå¼Workeræ¨¡å¼å’Œäº‹ä»¶é©±åŠ¨è®¾è®¡
- **æ™ºèƒ½è·¯ç”±**: åŒå±‚è·¯ç”±è¡¨ç²¾ç¡®æ¶ˆæ¯æŠ•é€’
- **å†…å­˜ä¼˜åŒ–**: é«˜æ•ˆå†…å­˜ç®¡ç†å’Œå¯¹è±¡æ± è®¾è®¡

### ğŸ› ï¸ å¼€å‘æ•ˆç‡
- **ä»£ç ç”Ÿæˆ**: åŸºäº Protobuf å’Œ Excel çš„è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆ
- **çƒ­é‡è½½**: é…ç½®è¡¨çƒ­æ›´æ–°å’Œç°åº¦å‘å¸ƒæ”¯æŒ
- **æµ‹è¯•å·¥å…·**: å†…ç½® Mercury å®¢æˆ·ç«¯æ¨¡æ‹Ÿå·¥å…·

### ğŸ“Š è¿ç»´ç›‘æ§
- **é“¾è·¯è¿½è¸ª**: OpenTelemetry åˆ†å¸ƒå¼è¿½è¸ª
- **æŒ‡æ ‡ç›‘æ§**: Prometheus å®æ—¶ç›‘æ§å’Œå‘Šè­¦
- **å¥åº·æ£€æŸ¥**: å®Œå–„çš„æœåŠ¡å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»

## æ¸¸æˆæ¨¡å—æ”¯æŒ

Roma å½“å‰æ”¯æŒä»¥ä¸‹æ¸¸æˆä¸šåŠ¡æ¨¡å—ï¼š

| æ¨¡å—         | æè¿°     | åŠŸèƒ½                             |
| ------------ | -------- | -------------------------------- |
| **Player**   | ç©å®¶æœåŠ¡ | ç©å®¶æ•°æ®ç®¡ç†ã€è¿›åº¦åŒæ­¥ã€å±æ€§ç®¡ç† |
| **Room**     | æˆ¿é—´æœåŠ¡ | æˆ¿é—´åˆ›å»ºã€ç®¡ç†                   |
| **Team**     | é˜Ÿä¼æœåŠ¡ | é˜Ÿä¼åˆ›å»ºã€åŠ å…¥ã€ç®¡ç†ç­‰åŠŸèƒ½       |
| **Fight**    | æˆ˜æ–—æœåŠ¡ | æˆ˜æ–—ç³»ç»Ÿç›¸å…³åŠŸèƒ½                 |
| **Chat**     | èŠå¤©æœåŠ¡ | èŠå¤©ç³»ç»Ÿç›¸å…³åŠŸèƒ½                 |
| **Notice**   | é€šçŸ¥æœåŠ¡ | é€šçŸ¥ç³»ç»Ÿç›¸å…³åŠŸèƒ½                 |
| **Activity** | æ´»åŠ¨æœåŠ¡ | æ´»åŠ¨ç³»ç»Ÿç›¸å…³åŠŸèƒ½                 |
| **Mail**     | é‚®ä»¶æœåŠ¡ | é‚®ä»¶ç³»ç»Ÿç›¸å…³åŠŸèƒ½                 |
| **Guild**    | å…¬ä¼šæœåŠ¡ | å…¬ä¼šç³»ç»Ÿç›¸å…³åŠŸèƒ½                 |

## ç³»ç»Ÿæ¶æ„

### ç³»ç»Ÿæ¶æ„æ€»è§ˆ

**ç»„ä»¶å…³ç³»å›¾ï¼š**

```mermaid
graph TB
    Client["ğŸ® æ¸¸æˆå®¢æˆ·ç«¯"]
    Lares["ğŸ” Lares<br/>(è®¤è¯æœåŠ¡)"]
    Janus["ğŸ”° Janus<br/>(ç½‘å…³æœåŠ¡)"]
    Senate["ğŸ“Š Senate<br/>(ç®¡ç†æœåŠ¡)"]

    subgraph Roma["âš™ï¸ Roma Monorepo"]
        direction LR
        Player["ğŸ‘¤ PlayeræœåŠ¡"]
        Room["ğŸ  RoomæœåŠ¡"]
        Team["ğŸ¤ TeamæœåŠ¡"]
        Other["... å…¶ä»–æœåŠ¡"]
    end

    Client -->|"1.è®¤è¯è¯·æ±‚"| Lares
    Lares -->|"è¿”å›ä»¤ç‰Œ"| Client
    Client -->|"2.æ¸¸æˆè¿æ¥"| Janus
    Janus -->|"3.gRPC è°ƒç”¨"| Player
    Janus -->|"gRPC è°ƒç”¨"| Room
    Janus -->|"gRPC è°ƒç”¨"| Team
    Player -->|"ä¸šåŠ¡å“åº”"| Janus
    Room -->|"ä¸šåŠ¡å“åº”"| Janus
    Team -->|"ä¸šåŠ¡å“åº”"| Janus
    Janus -->|"4.æ¸¸æˆæ•°æ®"| Client
    Roma -.->|"æœåŠ¡çŠ¶æ€"| Senate

    classDef clientStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef serviceStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef gatewayStyle fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef romaStyle fill:#fff3e0,stroke:#f57c00,stroke-width:3px

    class Client clientStyle
    class Lares,Senate serviceStyle
    class Janus gatewayStyle
    class Player,Room,Team,Other romaStyle
```

### Roma Monorepo æ¶æ„

**Roma å†…éƒ¨æ¶æ„å›¾ï¼š**

```mermaid
graph TB
    subgraph Roma["âš™ï¸ Roma Monorepo"]
        direction TB

        subgraph Services["ç‹¬ç«‹éƒ¨ç½²çš„æ¸¸æˆæœåŠ¡"]
            direction LR
            subgraph Player["ğŸ‘¤ Player æœåŠ¡"]
                PlayerAPI["API å±‚"]
                PlayerBiz["ä¸šåŠ¡å±‚"]
                PlayerData["æ•°æ®å±‚"]
            end

            subgraph Room["ğŸ  Room æœåŠ¡"]
                RoomAPI["API å±‚"]
                RoomBiz["ä¸šåŠ¡å±‚"]
                RoomData["æ•°æ®å±‚"]
            end

            subgraph Team["ğŸ¤ Team æœåŠ¡"]
                TeamAPI["API å±‚"]
                TeamBiz["ä¸šåŠ¡å±‚"]
                TeamData["æ•°æ®å±‚"]
            end
        end

        subgraph Shared["å…±äº«ç»„ä»¶åº“"]
            direction LR
            API["api/<br/>åè®®å®šä¹‰"]
            GameData["gamedata/<br/>é…ç½®å¤„ç†åº“"]
            PKG["pkg/<br/>é€šç”¨åº“"]
            Vulcan["vulcan/<br/>ä»£ç ç”Ÿæˆ"]
        end
    end

    subgraph Infrastructure["åŸºç¡€è®¾æ–½"]
        direction LR
        MongoDB["MongoDB<br/>æ•°æ®å­˜å‚¨"]
        Redis["Redis<br/>è·¯ç”±è¡¨"]
        Etcd["etcd<br/>æœåŠ¡å‘ç°"]
        Excel["Excel<br/>é…ç½®æ–‡ä»¶"]
    end

    PlayerData -.->|"æ•°æ®å­˜å‚¨"| MongoDB
    RoomData -.->|"æ•°æ®å­˜å‚¨"| MongoDB
    TeamData -.->|"æ•°æ®å­˜å‚¨"| MongoDB

    PlayerAPI -.->|"è·¯ç”±ç®¡ç†"| Redis
    RoomAPI -.->|"è·¯ç”±ç®¡ç†"| Redis
    TeamAPI -.->|"è·¯ç”±ç®¡ç†"| Redis

    PlayerAPI -.->|"æœåŠ¡æ³¨å†Œ"| Etcd
    RoomAPI -.->|"æœåŠ¡æ³¨å†Œ"| Etcd
    TeamAPI -.->|"æœåŠ¡æ³¨å†Œ"| Etcd

    PlayerBiz -.->|"ä½¿ç”¨"| GameData
    RoomBiz -.->|"ä½¿ç”¨"| GameData
    TeamBiz -.->|"ä½¿ç”¨"| GameData

    GameData -.->|"è¯»å–é…ç½®"| Excel

    classDef serviceStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef sharedStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef infraStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px

    class PlayerAPI,PlayerBiz,PlayerData,RoomAPI,RoomBiz,RoomData,TeamAPI,TeamBiz,TeamData serviceStyle
    class API,GameData,PKG,Vulcan sharedStyle
    class MongoDB,Redis,Etcd,Excel infraStyle
```

### æ ¸å¿ƒæ¶æ„ç‰¹æ€§

Roma æä¾›å®Œæ•´çš„æ¸¸æˆä¸šåŠ¡æµç¨‹æ”¯æŒï¼Œé‡‡ç”¨åˆ†å¸ƒå¼Workeræ¨¡å¼å’Œäº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œå®ç°é«˜å¹¶å‘ä½å»¶è¿Ÿçš„æ¸¸æˆä¸šåŠ¡å¤„ç†ã€‚é€šè¿‡åŒå±‚è·¯ç”±è¡¨è®¾è®¡ç¡®ä¿æ¶ˆæ¯ç²¾ç¡®æŠ•é€’ï¼Œæ”¯æŒå¤šå®ä¾‹é›†ç¾¤éƒ¨ç½²å’Œæ•°æ®ä¸€è‡´æ€§ä¿éšœã€‚



## æŠ€æœ¯æ ˆ

Roma ä½¿ç”¨ä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ï¼š

| æŠ€æœ¯/ç»„ä»¶     | ç”¨é€”               | ç‰ˆæœ¬    |
| ------------- | ------------------ | ------- |
| Go            | ä¸»è¦å¼€å‘è¯­è¨€       | 1.24+   |
| go-kratos     | å¾®æœåŠ¡æ¡†æ¶         | v2.8.4  |
| gRPC          | æœåŠ¡é—´é€šä¿¡         | v1.73.0 |
| Protobuf      | æ•°æ®åºåˆ—åŒ–         | v1.36.6 |
| etcd          | æœåŠ¡å‘ç°ä¸æ³¨å†Œ     | v3.6.1  |
| Redis         | è·¯ç”±è¡¨ç¼“å­˜         | v9.11.0 |
| MongoDB       | æ•°æ®å­˜å‚¨           | v2.2.2  |
| PostgreSQL    | æ•°æ®å­˜å‚¨           | v16.3   |
| OpenTelemetry | åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª     | v1.37.0 |
| Prometheus    | ç›‘æ§ç³»ç»Ÿ           | v1.22.0 |
| Google Wire   | ä¾èµ–æ³¨å…¥           | v0.6.0  |
| zap           | æ—¥å¿—è®°å½•           | v1.27.0 |
| Buf           | Protobuf ç®¡ç†      | Latest  |
| fabrica-kit   | go-pantheon å·¥å…·åŒ… | v0.0.20 |
| fabrica-net   | go-pantheon ç½‘ç»œåº“ | v0.0.21 |
| fabrica-util  | go-pantheon å·¥å…·åº“ | v0.0.28 |




## å¿«é€Ÿå¼€å§‹

### å¿«é€Ÿä½“éªŒ

å¦‚æœæ‚¨æƒ³å¿«é€Ÿä½“éªŒRomaæ¸¸æˆæœåŠ¡ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### 1. å®‰è£…åŸºç¡€æœåŠ¡

è¯·ç¡®ä¿ä»¥ä¸‹æœåŠ¡å·²å®‰è£…å¹¶æ­£å¸¸è¿è¡Œï¼š
- **etcd**: æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†
- **MongoDB**: ä¸»è¦æ•°æ®å­˜å‚¨
- **PostgreSQL**: å…³ç³»å‹æ•°æ®å­˜å‚¨
- **Redis**: è·¯ç”±è¡¨å­˜å‚¨

### 2. é…ç½®æœåŠ¡

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cd app/player
cp -r configs.tmpl/ configs/

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š
# - æ•°æ®åº“è¿æ¥ä¿¡æ¯
# - æœåŠ¡ç«¯å£è®¾ç½®
# - etcd å’Œ Redis è¿æ¥åœ°å€
```

é…ç½®æ–‡ä»¶ç¤ºä¾‹ä¿®æ”¹ï¼š
```yaml
# configs/config.yaml
server:
  http:
    addr: 0.0.0.0:8000
  grpc:
    addr: 0.0.0.0:9000

data:
  database:
    source: "mongodb://localhost:27017/roma"
  redis:
    addr: "localhost:6379"

registry:
  etcd:
    endpoints: ["localhost:2379"]
```

### 3. å¯åŠ¨Janusç½‘å…³æœåŠ¡

é¦–å…ˆéœ€è¦å¯åŠ¨Janusç½‘å…³æœåŠ¡ä½œä¸ºæµé‡å…¥å£ï¼š

```bash
# è¯·å‚è€ƒ go-pantheon/janus é¡¹ç›®æ–‡æ¡£å¯åŠ¨ç½‘å…³æœåŠ¡
# ç¡®ä¿JanusæœåŠ¡åœ¨é»˜è®¤ç«¯å£å¯åŠ¨å¹¶èƒ½å¤Ÿå‘ç°RomaæœåŠ¡
```

### 4. å¯åŠ¨PlayeræœåŠ¡

```bash
# åœ¨ app/player ç›®å½•ä¸‹
make run
```

### 5. é…ç½®å¹¶å¯åŠ¨Mercuryæµ‹è¯•å·¥å…·

```bash
# å¤åˆ¶Mercuryé…ç½®æ¨¡æ¿
cd mercury
cp -r configs.tmpl/ configs/

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ£€æŸ¥TCPè¿æ¥åœ°å€
# ç¡®ä¿é…ç½®ä¸­çš„TCPåœ°å€æŒ‡å‘Janusç½‘å…³æœåŠ¡
```

é…ç½®æ–‡ä»¶æ£€æŸ¥è¦ç‚¹ï¼š
```yaml
# mercury/configs/config.yaml
client:
  tcp:
    addr: "localhost:17001"  # Janusç½‘å…³TCPç«¯å£
```

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨Mercury
make mercury
```

Mercuryå°†é€šè¿‡Janusç½‘å…³è¿æ¥åˆ°PlayeræœåŠ¡å¹¶æ‰§è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•ã€‚

## é¡¹ç›®ç»“æ„

Roma é‡‡ç”¨ monorepo æ¶æ„ï¼Œç»Ÿä¸€ç®¡ç†å¤šä¸ªç‹¬ç«‹éƒ¨ç½²çš„å¾®æœåŠ¡ï¼š

```
.
â”œâ”€â”€ api/                # å…±äº« API åè®®å®šä¹‰
â”‚   â”œâ”€â”€ client/         # å®¢æˆ·ç«¯é€šä¿¡åè®®
â”‚   â”œâ”€â”€ db/             # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ server/         # æœåŠ¡ç«¯å†…éƒ¨åè®®
â”œâ”€â”€ app/                # ç‹¬ç«‹æ¸¸æˆæœåŠ¡é›†ç¾¤
â”‚   â”œâ”€â”€ player/         # ç©å®¶æœåŠ¡ï¼ˆç‹¬ç«‹éƒ¨ç½²ï¼‰
â”‚   â””â”€â”€ room/           # æˆ¿é—´æœåŠ¡ï¼ˆç‹¬ç«‹éƒ¨ç½²ï¼‰
â”œâ”€â”€ exceldata/          # å…±äº«æ¸¸æˆé…ç½®æ•°æ®
â”œâ”€â”€ gamedata/           # å…±äº«æ¸¸æˆæ•°æ®å¤„ç†é€»è¾‘
â”œâ”€â”€ gen/                # è‡ªåŠ¨ç”Ÿæˆä»£ç 
â”œâ”€â”€ mercury/            # ç‹¬ç«‹æµ‹è¯•å·¥å…·æœåŠ¡
â”œâ”€â”€ pkg/                # å…±äº«åº“å’Œæ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ universe/       # æ ¸å¿ƒä¸šåŠ¡æ¡†æ¶
â”‚   â””â”€â”€ util/           # å·¥å…·å‡½æ•°
â””â”€â”€ vulcan/             # ç‹¬ç«‹ä»£ç ç”Ÿæˆå·¥å…·æœåŠ¡
```


### å¼€å‘ç¯å¢ƒæ­å»º

å¦‚æœæ‚¨æƒ³å‚ä¸Romaçš„å¼€å‘ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ­å»ºå®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼š

#### 1. åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…å¼€å‘å·¥å…·é“¾
make init
```

è¿™å°†å®‰è£…ä»¥ä¸‹å¼€å‘å·¥å…·ï¼š
- Protocol Buffers ç¼–è¯‘å™¨
- go-kratos ä»£ç ç”Ÿæˆå·¥å…·
- Wire ä¾èµ–æ³¨å…¥å·¥å…·
- golangci-lint ä»£ç æ£€æŸ¥å·¥å…·

#### 2. æ·»åŠ æ–°çš„APIåè®®ï¼ˆä»¥åœ¨PlayeræœåŠ¡ä¸‹æ·»åŠ æ–°æ¨¡å—ä¸ºä¾‹ï¼‰

**æ·»åŠ å®¢æˆ·ç«¯åè®®**

**é‡è¦æé†’**ï¼š
- æ¨¡å—åå’Œæ–‡ä»¶åéœ€è¦ä¿æŒä¸€è‡´
- å®¢æˆ·ç«¯æ¶ˆæ¯ä½¿ç”¨ `CS` (Client to Server) å’Œ `SC` (Server to Client) å‰ç¼€
- æœåŠ¡ç«¯æ¨é€æ¶ˆæ¯ä½¿ç”¨ `@push` æ³¨é‡Šæ ‡è®°

1. åœ¨ `api/client/message/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æœåŠ¡å®šä¹‰ï¼š

```protobuf
// api/client/message/item_service.proto (æ–‡ä»¶åä¸æ¨¡å—åä¸€è‡´)
syntax = "proto3";

package api.client.message;

service NewModuleService {
	// Dev command list
	rpc Echo (CSEcho) returns (SCEcho) {
		option (google.api.http) = {
			post: "/newmodule/echo"
			body: "*"
		};
	};
}

// å®¢æˆ·ç«¯è¯·æ±‚æ¶ˆæ¯ï¼ˆCSå‰ç¼€ï¼‰
message CSEcho {
  string msg = 1;
}

// æœåŠ¡ç«¯å“åº”æ¶ˆæ¯ï¼ˆSCå‰ç¼€ï¼‰
// å®šä¹‰å“åº”ç  0: é»˜è®¤å¤±è´¥ï¼Œ1: æˆåŠŸï¼Œå…¶ä»–: è‡ªå®šä¹‰é”™è¯¯ç 
message SCEcho {
  Code code = 1; // å“åº”ç 
	enum Code {
		ErrUnspecified = 0; // Please try again later
		Succeeded = 1; // Succeeded
	}

  string msg = 2;
}

// æœåŠ¡ç«¯æ¨é€æ¶ˆæ¯
message SCPushEcho {
  string msg = 1;
}
```

2. æ›´æ–°æ¨¡å—å’Œåºåˆ—å®šä¹‰ï¼š

```protobuf
// api/client/module/modules.proto
enum ModuleID {
  NewModule = 8; // æ¨¡å—åä¸æ–‡ä»¶åä¸€è‡´
}

// api/client/sequence/newmodule.proto (æ–‡ä»¶åä¸æ¨¡å—åä¸€è‡´)
enum NewModuleSeq {
  Echo = 1;
  // @pushï¼ˆä½¿ç”¨@pushæ³¨é‡Šï¼‰
  PushEcho = 2;
}
```

**ç”ŸæˆAPIåè®®ä»£ç **

åè®®ç¼–å†™å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä»£ç ï¼š

```bash
# ç”ŸæˆAPIåè®®ä»£ç 
make api
```

**å¦‚æœ‰éœ€è¦ï¼Œæ·»åŠ æ•°æ®åº“æ¨¡å‹**

åœ¨ `api/db/player/` ç›®å½•ä¸‹å®šä¹‰æ•°æ®æ¨¡å‹ï¼š

```protobuf
// api/db/player/newmodule.proto
syntax = "proto3";

package player.v1;

option go_package = "api/db/player/v1;dbv1";


// Basic Information
message NewModuleProto {
  string name = 1; // @gotags: bson:"name"
  int32 type = 2; // @gotags: bson:"type"
  int64 created_at = 3; // @gotags: bson:"created_at"
}

// å°†æ–°æ¨¡å—æ·»åŠ åˆ°UserModuleProtoä¸­
message UserModuleProto {
  oneof module {
    // ...
    NewModuleProto new_module = 3;
  }
}

```


**ç”ŸæˆDBåè®®ä»£ç **

åè®®ç¼–å†™å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä»£ç ï¼š

```bash
# ç”Ÿæˆæ•°æ®åº“æ¨¡å‹ä»£ç 
make db
```

#### 3. å®ç°ä¸šåŠ¡é€»è¾‘ï¼ˆå‚è€ƒapp/player/internal/app/hero/gateæ¶æ„ï¼‰

**åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„**

```bash
mkdir -p app/player/internal/app/newmodule/gate/{service,biz,domain,registry}
mkdir -p app/player/internal/app/newmodule/gate/domain/object
```

**åˆ›å»ºServiceå±‚**

```go
// app/player/internal/app/newmodule/gate/service/newmodule.go
package service

import (
    "context"

    "github.com/go-kratos/kratos/v2/log"
    "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate/biz"
    "github.com/go-pantheon/roma/app/player/internal/core"
    climsg "github.com/go-pantheon/roma/gen/api/client/message"
)

type NewModuleService struct {
    climsg.UnimplementedNewModuleServiceServer

    uc  *biz.NewModuleUseCase
    log *log.Helper
}

func NewNewModuleService(logger log.Logger, uc *biz.NewModuleUseCase) climsg.NewModuleServiceServer {
    return &NewModuleService{
        log: log.NewHelper(log.With(logger, "module", "player/newmodule/gate/service")),
        uc:  uc,
    }
}

func (s *NewModuleService) Echo(ctx context.Context, cs *climsg.CSEcho) (*climsg.SCEcho, error) {
    // è½¬æ¢ä¸ºcore.Contextï¼Œè®¿é—®ç”¨æˆ·æ•°æ®å’Œæ¸¸æˆçŠ¶æ€
    return s.uc.Echo(ctx.(core.Context), cs)
}
```

**åˆ›å»ºBizå±‚ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰**

```go
// app/player/internal/app/newmodule/gate/biz/newmodule.go
package biz

import (
    "github.com/go-kratos/kratos/v2/log"
    "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate/domain"
    "github.com/go-pantheon/roma/app/player/internal/core"
    climsg "github.com/go-pantheon/roma/gen/api/client/message"
)

func NewNewModuleUseCase(mgr *core.Manager, logger log.Logger,
    newmoduleDo *domain.NewModuleDomain,
) *NewModuleUseCase {
    uc := &NewModuleUseCase{
        log:         log.NewHelper(log.With(logger, "module", "player/newmodule/gate/biz")),
        mgr:         mgr,
        newmoduleDo: newmoduleDo,
    }

    // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
    // mgr.RegisterOnCreatedEvent(uc.onCreated)

    return uc
}

type NewModuleUseCase struct {
    log         *log.Helper
    mgr         *core.Manager
    newmoduleDo *domain.NewModuleDomain
}

func (uc *NewModuleUseCase) Echo(ctx core.Context, cs *climsg.CSEcho) (*climsg.SCEcho, error) {
    sc := &climsg.SCEcho{}

    // è¾“å…¥éªŒè¯
    if len(cs.Msg) == 0 {
        sc.Code = climsg.SCEcho_ErrUnspecified
        return sc, nil
    }

    // è°ƒç”¨é¢†åŸŸæœåŠ¡å¤„ç†ä¸šåŠ¡é€»è¾‘
    result, err := uc.newmoduleDo.ProcessEcho(ctx, cs.Msg)
    if err != nil {
        uc.log.WithContext(ctx).Errorf("process echo failed: %+v", err)
        sc.Code = climsg.SCEcho_ErrUnspecified
        return sc, nil
    }

    // æ ‡è®°ç”¨æˆ·æ•°æ®å·²å˜æ›´ï¼ˆç”¨äºè‡ªåŠ¨ä¿å­˜ï¼‰
    // ctx.Changed(object.ModuleKey)

    sc.Code = climsg.SCEcho_Succeeded
    sc.Msg = result

    return sc, nil
}
```

**åˆ›å»ºDomainå±‚ï¼ˆé¢†åŸŸæœåŠ¡å±‚ï¼‰**

```go
// app/player/internal/app/newmodule/gate/domain/newmodule.go
package domain

import (
    "github.com/go-kratos/kratos/v2/log"
    "github.com/go-pantheon/roma/app/player/internal/core"
    // "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate/domain/object"
)

type NewModuleDomain struct {
    log *log.Helper
}

func NewNewModuleDomain(logger log.Logger) *NewModuleDomain {
    return &NewModuleDomain{
        log: log.NewHelper(log.With(logger, "module", "player/newmodule/gate/domain")),
    }
}

func (do *NewModuleDomain) ProcessEcho(ctx core.Context, msg string) (string, error) {
    // è®¿é—®ç”¨æˆ·æ•°æ®
    // user := ctx.User()

    // å®ç°å…·ä½“çš„ä¸šåŠ¡è§„åˆ™
    // ä¾‹å¦‚ï¼šéªŒè¯æƒé™ã€æ£€æŸ¥æ¡ä»¶ã€æ›´æ–°çŠ¶æ€ç­‰
    processedMsg := "Echo: " + msg

    do.log.WithContext(ctx).Infof("processed echo message: %s -> %s", msg, processedMsg)

    return processedMsg, nil
}
```

**åˆ›å»ºDomain Objectï¼ˆé¢†åŸŸå¯¹è±¡ï¼‰**

```go
// app/player/internal/app/newmodule/gate/domain/object/newmodule.go
package object

import (
    climsg "github.com/go-pantheon/roma/gen/api/client/message"
    dbv1 "github.com/go-pantheon/roma/gen/api/db/player/v1"
)

const ModuleKey = "newmodule"

// NewModuleData é¢†åŸŸå¯¹è±¡ï¼Œå®šä¹‰æ–°æ¨¡å—çš„æ•°æ®ç»“æ„
type NewModuleData struct {
    Name      string
    Type      int32
    Count     int64
    CreatedAt int64
}

// ä»æ•°æ®åº“æ¨¡å‹è§£ç 
func (o *NewModuleData) DecodeServer(p *dbv1.NewModuleProto) *NewModuleData {
    if p == nil {
        return o
    }

    o.Name = p.Name
    o.Type = p.Type
    o.CreatedAt = p.CreatedAt

    return o
}

// ç¼–ç ä¸ºæ•°æ®åº“æ¨¡å‹
func (o *NewModuleData) EncodeServer() *dbv1.NewModuleProto {
    return &dbv1.NewModuleProto{
        Name:      o.Name,
        Type:      o.Type,
        CreatedAt: o.CreatedAt,
    }
}

// ç¼–ç ä¸ºå®¢æˆ·ç«¯åè®®ï¼ˆå¦‚æœéœ€è¦ï¼‰
func (o *NewModuleData) EncodeClient() *climsg.NewModuleProto {
    return &climsg.NewModuleProto{
        Name: o.Name,
        Type: o.Type,
    }
}
```

**åˆ›å»ºRegistryå±‚ï¼ˆæœåŠ¡æ³¨å†Œï¼‰**

```go
// app/player/internal/app/newmodule/gate/registry/registry.go
package registry

import (
    "github.com/go-kratos/kratos/v2/log"
    "github.com/go-kratos/kratos/v2/transport/grpc"
    "github.com/go-kratos/kratos/v2/transport/http"
    climsg "github.com/go-pantheon/roma/gen/api/client/message"
)

func NewNewModuleRegistrar(svc climsg.NewModuleServiceServer) *NewModuleRegistrar {
    return &NewModuleRegistrar{
        svc: svc,
    }
}

type NewModuleRegistrar struct {
    svc climsg.NewModuleServiceServer
}

func (r *NewModuleRegistrar) GrpcRegister(s *grpc.Server) {
    climsg.RegisterNewModuleServiceServer(s, r.svc)
    log.Infof("Register newmodule gRPC service")
}

func (r *NewModuleRegistrar) HttpRegister(s *http.Server) {
    climsg.RegisterNewModuleServiceHTTPServer(s, r.svc)
    log.Infof("Register newmodule HTTP service")
}
```

#### 4. é…ç½®ä¾èµ–æ³¨å…¥ï¼ˆProviderï¼‰

**å„å±‚Provideræ–‡ä»¶**

```go
// app/player/internal/app/newmodule/gate/service/provider.go
package service

import "github.com/google/wire"

var ProviderSet = wire.NewSet(
    NewNewModuleService,
)

// app/player/internal/app/newmodule/gate/biz/provider.go
package biz

import "github.com/google/wire"

var ProviderSet = wire.NewSet(
    NewNewModuleUseCase,
)

// app/player/internal/app/newmodule/gate/domain/provider.go
package domain

import "github.com/google/wire"

var ProviderSet = wire.NewSet(
    NewNewModuleDomain,
)

// app/player/internal/app/newmodule/gate/registry/provider.go
package registry

import "github.com/google/wire"

var ProviderSet = wire.NewSet(
    NewNewModuleRegistrar,
)

// app/player/internal/app/newmodule/gate/provider.go
package gate

import (
    "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate/biz"
    "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate/domain"
    "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate/registry"
    "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate/service"
    "github.com/google/wire"
)

var ProviderSet = wire.NewSet(
    biz.ProviderSet,
    domain.ProviderSet,
    service.ProviderSet,
    registry.ProviderSet,
)

// app/player/internal/app/newmodule/provider.go
package newmodule

import (
    "github.com/go-pantheon/roma/app/player/internal/app/newmodule/gate"
    "github.com/google/wire"
)

var ProviderSet = wire.NewSet(
    gate.ProviderSet,
)
```

**æ³¨å†Œåˆ°åº”ç”¨å±‚**

```go
// app/player/internal/app/provider.go
// åœ¨ç°æœ‰çš„provider.goæ–‡ä»¶ä¸­æ·»åŠ NewModuleçš„ProviderSet
var ProviderSet = wire.NewSet(
    // ... ç°æœ‰çš„providers
    newmodule.ProviderSet,  // æ·»åŠ è¿™ä¸€è¡Œ
)

// app/player/internal/server/http.go
// æ³¨å†ŒHTTPæœåŠ¡
func NewHTTPServer(c *conf.Server,
    // ... å…¶ä»–å‚æ•°
    newmoduleRegistrar *newmoduleregistry.NewModuleRegistrar,
) *http.Server {
    // ... æœåŠ¡å™¨é…ç½®

    // æ³¨å†ŒNewModuleæœåŠ¡
    newmoduleRegistrar.HttpRegister(srv)

    return srv
}

// app/player/internal/server/grpc.go
// æ³¨å†ŒgRPCæœåŠ¡
func NewGRPCServer(c *conf.Server,
    // ... å…¶ä»–å‚æ•°
    newmoduleRegistrar *newmoduleregistry.NewModuleRegistrar,
) *grpc.Server {
    // ... æœåŠ¡å™¨é…ç½®

    // æ³¨å†ŒNewModuleæœåŠ¡
    newmoduleRegistrar.GrpcRegister(srv)

    return srv
}
```

#### 5. ç”Ÿæˆä»£ç 

```bash
# ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç 
make wire
```

#### 6. æ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»ºæœåŠ¡
make build

# å¯åŠ¨æœåŠ¡
make run app=player
```

#### 7. ä½¿ç”¨RESTfulå·¥å…·æµ‹è¯•HTTPæ¥å£

RomaæœåŠ¡ä¼šè‡ªåŠ¨ç”ŸæˆHTTPæ¥å£ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Postmanã€curlæˆ–å…¶ä»–RESTfulæµ‹è¯•å·¥å…·è¿›è¡Œæ¨¡å—æµ‹è¯•ï¼š

```bash
# æµ‹è¯•åˆ›å»ºç‰©å“æ¥å£
curl -X POST http://localhost:19001/newmodule/echo \
  -H "Content-Type: application/json" \
  -d '{
    "msg": "Hello, World!"
  }'

# æµ‹è¯•æ–°æ¨¡å—æ¥å£
curl -X GET http://localhost:19001/newmodule/echo \
  -H "Content-Type: application/json" \
  -d '{
    "msg": "Hello, World!"
  }'
```

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨Postmanç­‰å›¾å½¢åŒ–å·¥å…·ï¼š
1. å¯¼å…¥ç”Ÿæˆçš„OpenAPIæ–‡æ¡£ï¼ˆé€šå¸¸åœ¨ `/swagger` ç«¯ç‚¹å¯è®¿é—®ï¼‰
2. é…ç½®è¯·æ±‚å¤´å’Œå‚æ•°
3. å‘é€è¯·æ±‚å¹¶éªŒè¯å“åº”ç»“æœ

**æµ‹è¯•è¦ç‚¹**ï¼š
- æ£€æŸ¥HTTPçŠ¶æ€ç æ˜¯å¦æ­£ç¡®
- éªŒè¯å“åº”æ•°æ®æ ¼å¼å’Œå†…å®¹
- æµ‹è¯•å„ç§è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯æƒ…å†µ
- ç¡®è®¤æ•°æ®åœ¨æ•°æ®åº“ä¸­æ­£ç¡®å­˜å‚¨

## ç”Ÿæ€é›†æˆ

Roma ä¸ go-pantheon ç”Ÿæ€ç³»ç»Ÿæ— ç¼é›†æˆï¼š

- **Janus ç½‘å…³**: è‡ªåŠ¨æœåŠ¡å‘ç°å’Œè·¯ç”±è½¬å‘ï¼Œåè®®è‡ªåŠ¨åˆ†å‘åˆ°å¯¹åº”æ¨¡å—
- **Senate ç®¡ç†**: æ”¯æŒåå°ç®¡ç†æ¥å£ï¼Œæä¾›è¿è¥æ•°æ®å’Œç®¡ç†åŠŸèƒ½


## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªæ ‡å‡†çš„ GitHub å·¥ä½œæµï¼šFork â†’ åˆ†æ”¯ â†’ æäº¤ â†’ Pull Request

**å¼€å‘è§„èŒƒ**: éµå¾ª Go æœ€ä½³å®è·µï¼Œæ·»åŠ æµ‹è¯•ï¼Œæ›´æ–°æ–‡æ¡£ï¼Œç¡®ä¿ CI é€šè¿‡

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [MIT License](https://github.com/go-pantheon/roma/blob/main/LICENSE) å¼€æºåè®®ã€‚

---

<div align="center">
  <p>âœ¨ <strong>Roma æ¸¸æˆæ ¸å¿ƒä¸šåŠ¡æœåŠ¡</strong> - é«˜æ€§èƒ½æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶<p>
  <p>ğŸ›ï¸ <em>go-pantheon ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</em> ğŸ›ï¸</p>
</div>
